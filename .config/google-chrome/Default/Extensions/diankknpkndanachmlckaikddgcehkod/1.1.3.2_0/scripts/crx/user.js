define(function(require,exports){var a=require("service/prefs"),b=require("utils/server"),c=require("configs/settings"),d=require("utils/log"),e="account_info";exports.getUser=function(f){var g=localStorage.getItem(e),h={},i={logined:!1,domain:c.domain,showMeridiem:a.get("showMeridiem"),startDayOfWeek:a.get("startDayOfWeek"),lunarEnabled:!1};if(g){try{h=JSON.parse(g)}catch(j){d.log("ERROR :: cannot parse `useraccount`")}h.username&&(i.logined=!0),f&&f(i)}else b.getUserStatus(function(a){c.user.userId=a.userId,c.user.username=a.username,c.user.isGFS=a.pro,c.end_date=a.proEndDate,c.user.inboxId=a.inboxId,localStorage.setItem(e,JSON.stringify(a)),i.logined=!0,f&&f(i)},function(a,b,c){d.info(a),d.info(b),d.info(c),f&&f(i)});return i},exports.initUserStatus=function(a){b.getUserStatus(function(b){c.user.userId=b.userId,c.user.username=b.username,c.user.isGFS=b.pro,c.end_date=b.proEndDate,c.user.inboxId=b.inboxId,localStorage.setItem(e,JSON.stringify(b)),a&&a()},function(){a&&a()})}});