define(function(require,exports){var a=require("utils/crx"),b=require("configs/settings"),c=require("lang/index"),d=require("utils/timeformat"),e=require("dao/taskdb"),f=(require("utils/log"),require("service/prefs")),g=require("configs/dict"),h=require("utils/analytics");exports.notify=function(c){var d=this;root.tabs.query({url:b.protocol+b.domain+"/"},function(b){b&&b.length||a.ifSupportRichNotification()&&d.createRichNotification(c)})},exports.createRichNotification=function(a){if(f.get("showMeridiem"))var b="YYYY-MM-DD hh:mm A";else var b="YYYY-MM-DD HH:mm";var e={type:"basic",title:d.prefMomentFromUtc(a.get("startDate")).format(b),message:a.get("title")};e.iconUrl="/img/icon_128.png",e.priority=2,e.requireInteraction=!0,e.buttons=[],e.buttons.push({title:c.get("mark")+" "+c.get("complete_status")}),e.buttons.push({title:c.get("postpone_snooze_title")+" "+c.get("after_15minutes")}),root.notifications.create("tid_"+a.get("projectId")+"_"+a.get("id"),e,this.creationCallback)},exports.creationCallback=function(a){},exports.notificationClosed=function(a,b){},exports.notificationClicked=function(a){h.report("chromeExtension","notificationClicked");var c=a.split("_");root.notifications.clear(a,function(){}),root.tabs.query({url:b.protocol+b.domain+"/"},function(a){a&&a.length?chrome.window.get(a[0].windowId,function(a){a.focus()}):window.open(b.protocol+b.domain+"/#p/"+c[1]+"/tasks/"+c[2])})},exports.notificationBtnClick=function(a,b){var c=a.split("_");if(0==b){var f=e.db.getById(c[2]);f.toggleModelComplete(),h.report("chromeExtension","notificationCompleted")}else if(1==b){var f=e.db.getById(c[2]),i=moment().add("m",15),j=d.prefMoment(i).utc().format(g.format.atomTime);f.set("remindTime",j),f.save(),h.report("chromeExtension","notificationSnooze")}root.notifications.clear(a,function(){})}});