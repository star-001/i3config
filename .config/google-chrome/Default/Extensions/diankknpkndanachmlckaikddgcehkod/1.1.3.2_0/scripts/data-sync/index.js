define(function(require,exports){var a=require("dao/taskdb").db,b=require("dao/projectdb").db,c=require("offline/storage"),d=require("utils/server"),e=require("utils/index"),f=function(){this.point=0};f.prototype.task=function(b){for(var c=b.update||[],d=b.deletedInTrash||[],e=b.deletedForever||[],f=0;f<c.length;f++){var g=c[f],h=a.getById(g.id);_.isUndefined(h)?a.add(g):h.set(g)}for(var f=0;f<d.length;f++){var g=d[f];a.deleteById(g.taskId)}for(var f=0;f<e.length;f++){var g=e[f];a.deleteById(g.taskId)}},f.prototype.project=function(a){_.isNull(a)||b.mergeSetToLocal(a)},f.prototype.sync=function(){var b=this;d.dataSync(b.point,function(c){b.point=c.checkPoint?c.checkPoint:b.point,b.project(c.projectProfiles),b.task(c.syncTaskBean),e.setBadgeForExtension(a.countTodoTasks())})},f.prototype.clear=function(){this.point=0,a.flush(),b.flush(),c.flush()},f.prototype.once=function(){this.sync()},f.prototype.start=function(){var a=this;a.sync(),setInterval(function(){a.sync()},6e5)},f.prototype.restart=function(){this.stop(),this.start()},f.prototype.stop=function(){e.setBadgeForExtension(0),this.timer&&(clearInterval(this.timer),this.timer=null),this.clear()};var g=new f;return g});