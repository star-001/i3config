!function(){function a(){var a=navigator.userAgent.toLowerCase(),b=(a.match(/safari/)&&null===a.match(/chrome/),null!==a.match(/chrome/)),c=null!==a.match(/firefox/),d=(null!==a.match(/trident/),null!==a.match(/msie 10.0/),null!==a.match(/edge/));b&&(r=chrome,r.isChrome=!0),c&&(r=browser,r.isFirefox=!0),d&&(r=browser,r.isEdge=!0)}function b(){var a=u.isCnSites?"/html/frame_dd.html":"/html/frame_tt.html";v.iframe=document.createElement("iframe"),$(v.iframe).ready(function(){h(),y||(y=setInterval(h,1e3))}),v.iframe.src=r.extension.getURL(a),v.iframe.id="tt-iframe",document.body.appendChild(v.iframe),n(),d(),q()}function c(){if(!v.$status){if(document.getElementById("tk-status"))return void(v.$status=$("#tk-status"));v.$status=$('<div id="tk-status"><div class="status"></div></div>'),$("body").append(v.$status),v.$status.css({visibility:"hidden",position:"fixed",top:"50px",width:"100%","text-align":"center","margin-top":"-20px","z-index":99999999}).find(".status").css({display:"inline-block","font-size":"14px","font-weight":"bold",border:"1px solid #f0c36d","background-color":"#f9edbe",padding:"0 10px","border-radius":"2px","box-shadow":"0 2px 4px rgba(0,0,0,0.2)"})}}function d(){$(window).on("message.tick_extension",f)}function e(){$(window).off("message.tick_extension")}function f(a){var b=a.originalEvent;"load completed"==b.data?(y&&(clearInterval(y),y=null),g()):"add sucess"==b.data.status?(k(b.data),p()):"login first"==b.data?j():"adding task"==b.data?l():"close iframe"==b.data?p():"add failed"==b.data&&m()}function g(){if(x.status="show iframe",x.info&&!x.info.selectionText){if("GMAIL"===w){var a=$(".hP:visible").text(),b=document.location.href,c=$(".ii").eq(0).text().trim().replace(/(\n\s*){4,}/g,"\n\n\n\n");(a||c)&&(x.pageInfo={title:a,url:b,content:c})}if("OUTLOOK"===w){var a=($(".tk-button:visible").parents("._rp_b5"),$(".conductorContent .rpHighlightAllClass.rpHighlightSubjectClass").text()),b=document.location.href,d=document.getElementById("Item.MessageNormalizedBody");if(d)var c=d.innerText.trim().replace(/(\n\s*){4,}/g,"\n\n\n\n");(a||c)&&(x.pageInfo={title:a,url:b,content:c})}}i()}function h(){x.status="set origin",x.referer=location.href,x.channel="context",i()}function i(){sendIframe=v.iframe.contentWindow,sendIframe&&sendIframe.postMessage(x,r.extension.getURL("/"))}function j(){var a=t.login_before+"<a href='"+u.site+"' target='_blank' style='color: #222; text-decoration: underline;'>"+u.productName+"</a>"+t.add_task;v.$status.css("visibility","visible").find(".status").html(a),setTimeout(function(){v.$status.css("visibility","hidden")},1e4)}function k(a){var b=t.task_has_been_saved+u.productName+", <a href='"+u.site+"/#p/"+a.projectId+"/tasks/"+a.taskId+"' target='_blank' style='color: #222; text-decoration: underline;'>"+t.check_here+"</a>";v.$status.css("visibility","visible").find(".status").html(b),setTimeout(function(){v.$status.css("visibility","hidden")},3e3)}function l(){v.$status.css("visibility","visible").find(".status").text(""+t.adding_task_to+u.productName+"...")}function m(){v.$status.css("visibility","visible").find(".status").text(t.add_failed)}function n(){var a=document.body.clientTop+50+"px",b="100px";$("#tt-iframe").css({position:"fixed","z-index":0x27797f26d671c8,height:"420px",width:"315px",border:0,top:a,right:b,display:"none"})}function o(){e(),$("#tt-iframe").remove()}function p(){$("#tt-iframe").hide()}function q(){$("#tt-iframe").show()}var r=null;if(a(),r){var s={en:{login_before:"Please signin ",add_task:" before adding tasks",add_to_ticktick:"Add To ",task_has_been_saved:"Task has been saved in ",check_here:"check here",adding_task_to:"Adding task to ",add_failed:"Add Failed"},zh:{login_before:"请先登录 ",add_task:" 然后添加任务",add_to_ticktick:"添加至",task_has_been_saved:"任务已经被添加到",check_here:"点击查看",adding_task_to:"添加任务至",add_failed:"添加失败"}},t=s.en,u={},v={},w="",x=null,y=null,z=location.href.match(/^http[s]?:\/\/(mail.google|inbox.google|outlook.live).com/);if(z&&z[1]){var A={"mail.google":"GMAIL","inbox.google":"INBOX","outlook.live":"OUTLOOK"};w=A[z[1]]}var B=function(a){var b="https://",c=a.match(/ticktick/)?!1:!0,d=navigator.language.replace("_","-").toLowerCase(),e=/zh\Scn/i.test(d);u={domain:a,isCnSites:c,productName:c?"滴答清单":"TickTick",site:b+a},t=e?s.zh:s.en},C=function(a){B(a.domain)};r.runtime.onMessage.addListener(function(a,d,e){x=a,c(),"showProject"===a.action?a.domain===u.domain?v.iframe?(q(),g()):r.runtime.sendMessage(r.runtime.id,{action:"user-status"},function(a){C(a),x=a,b()}):(C(a),o(),b()):r.runtime.sendMessage(r.runtime.id,{action:"default-status"},function(a){C(a),j()})})}}();