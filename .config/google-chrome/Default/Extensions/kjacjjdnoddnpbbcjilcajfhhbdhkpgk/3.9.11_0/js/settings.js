(function(){"use strict";var TAG;var DefaultTAG=[{tag_id:0,title:chrome.i18n.getMessage("plant_tag_0")},{tag_id:1,title:chrome.i18n.getMessage("plant_tag_1")},{tag_id:2,title:chrome.i18n.getMessage("plant_tag_2")},{tag_id:3,title:chrome.i18n.getMessage("plant_tag_3")},{tag_id:4,title:chrome.i18n.getMessage("plant_tag_4")},{tag_id:5,title:chrome.i18n.getMessage("plant_tag_5")},{tag_id:6,title:chrome.i18n.getMessage("plant_tag_6")},{tag_id:7,title:chrome.i18n.getMessage("plant_tag_7")}];var bgpage=chrome.extension.getBackgroundPage();var isHeaderHide=false;var lastScrollY=0;var isUploading=false;var EditingID=0;var EditTreeInfo=function(){var PTag=document.getElementById("edit-tag").value;var PNote=document.getElementById("edit-note").value;chrome.storage.local.get({grownTree:null,tempTag:null,tempNote:null},function(items){var grownTree=items.grownTree;console.log(grownTree);var plant=grownTree.find(function(p){return p.browserTreeID==EditingID});if(items.tempTag!=PTag||items.tempNote!=PNote){if(typeof plant.plant.id!=="undefined"&&plant.plant.id!=null){plant.syncState="WaitForSync"}var TagIdx=TAG.findIndex(function(t){return t.title==PTag});plant.plant.tag=parseInt(TAG[TagIdx].tag_id);plant.plant.note=PNote;if(grownTree!=null&&grownTree.length!=0){var oldestDate=new Date(0);var latestTreeTag=0;for(var i in grownTree){var p=grownTree[i].plant;var tmpDate=new Date(p.end_time);if(tmpDate>oldestDate){oldestDate=tmpDate;latestTreeTag=p.tag}}bgpage.saveLastTreeTagId(latestTreeTag)}}chrome.storage.local.set({grownTree:grownTree},function(){EditingID=0;window.setTimeout(function(){addClass(document.getElementById("edit-popup"),"disappear")},300);addClass(document.getElementById("edit-popup"),"edit-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"disappear")},300);initSyncList()})})};var updateEditUI=function(id){chrome.storage.local.get({grownTree:null},function(items){EditingID=id;var grownTree=items.grownTree;var plant=grownTree.find(function(p){return p.browserTreeID==id});var plantTag=plant.plant.tag;var plantNote=plant.plant.note;var editTag=document.getElementById("edit-tag");var TagIdx=TAG.findIndex(function(t){return t.tag_id==parseInt(plantTag)});if(TagIdx==-1){TagIdx=0}editTag.selectedIndex=TagIdx;var editNote=document.getElementById("edit-note");editNote.value=plantNote})};var clearEditTag=function(callback){var editTag=document.getElementById("edit-tag");while(editTag.options.length>0){editTag.remove(0)}callback()};var checkSyncState=function(treelist,callback){var treeIdx=0;var failcount=0;for(var Idx in treelist){if(treelist[Idx].syncState=="Fail"||treelist[Idx].syncState=="WaitForSync"||treelist[Idx].syncState=="EditFail"){failcount++}if(Idx==treelist.length-1){if(failcount==0){callback(true)}else{callback(false)}}}};var saveList=function(listType){var list=[];var bChilds;switch(listType){case"blacklist":bChilds=document.getElementById("blacklist").children;break;case"whitelist":bChilds=document.getElementById("whitelist").children;break;default:}for(var idx in bChilds){var tmpLi=bChilds[idx];if(typeof tmpLi.id!=="undefined"&&!tmpLi.id.startsWith("new")){var childs=tmpLi.children;for(var cidx in childs){if(childs[cidx].nodeName==="SPAN"){list.push(childs[cidx].textContent);break}}}}switch(listType){case"blacklist":bgpage.setBlacklist(list);chrome.storage.local.set({blackList:list},function(){});break;case"whitelist":bgpage.setWhitelist(list);chrome.storage.local.set({whiteList:list},function(){});break;default:}};var addTreeDaylist=function(treelist){var today=new Date;var yesterday=new Date;yesterday.setDate(today.getDate()-1);for(var tIdx in treelist){if(treelist[tIdx].length!=0){var date=new Date(treelist[tIdx][0].plant.end_time);var newdiv=document.createElement("DIV");newdiv.className="tree-day";var treeDate=document.createElement("DIV");treeDate.className="tree-date";var dateTitle=document.createElement("DIV");dateTitle.className="date-title";if(today.toDateString()==date.toDateString()){dateTitle.textContent=chrome.i18n.getMessage("settings_today")}else if(yesterday.toDateString()==date.toDateString()){dateTitle.textContent=chrome.i18n.getMessage("settings_yesterday")}else{dateTitle.textContent+=date.toLocaleString(navigator.language,{weekday:"long"})}var dateDay=document.createElement("DIV");dateDay.className="date-day";dateDay.textContent+=date.toLocaleString(navigator.language,{month:"long"})+" "+date.getDate();treeDate.appendChild(dateTitle);treeDate.appendChild(dateDay);newdiv.appendChild(treeDate);var treeList=document.createElement("UL");treeList.className="tree-daylist";var tmptreelist=treelist[tIdx];for(var lIdx in tmptreelist){var treeType=tmptreelist[lIdx].plant.trees[0].tree_type;var readyStage=tmptreelist[lIdx].plant.trees[tmptreelist[lIdx].plant.trees.length-1].phase;var sTime=new Date(tmptreelist[lIdx].plant.start_time);var eTime=new Date(tmptreelist[lIdx].plant.end_time);var tree=document.createElement("LI");tree.className="tree";var treeImg=document.createElement("IMG");var treeTagID=tmptreelist[lIdx].plant.tag;if(readyStage<3&&typeof bgpage.TREE_TYPE[treeType].special_childhood!=="undefined"){if(bgpage.TREE_TYPE[treeType].special_childhood.includes(parseInt(readyStage))){treeImg.src="./images/trees/tree1/"+"tree_default_"+readyStage+".png"}else{treeImg.src="./images/trees/tree"+(bgpage.TREE_TYPE[treeType].id+1)+"/"+bgpage.TREE_TYPE[treeType].prefix+"_"+readyStage+".png"}}else{if(readyStage==8){treeImg.src="./images/trees/tree"+(bgpage.TREE_TYPE[treeType].id+1)+"/"+bgpage.TREE_TYPE[treeType].prefix+"_dead.png"}else{treeImg.src="./images/trees/tree"+(bgpage.TREE_TYPE[treeType].id+1)+"/"+bgpage.TREE_TYPE[treeType].prefix+"_"+readyStage+".png"}}tree.appendChild(treeImg);var infoDiv=document.createElement("DIV");infoDiv.className="tree-info";var tag=document.createElement("DIV");tag.className="tree-tag";var treeTag=TAG.findIndex(function(t){return t.tag_id==treeTagID});if(treeTag==-1){treeTag=0}tag.textContent+=TAG[treeTag].title;var planttime=document.createElement("DIV");planttime.textContent+=sTime.toLocaleTimeString("en",{hour12:false,hour:"2-digit",minute:"2-digit"})+" - "+eTime.toLocaleTimeString("en",{hour12:false,hour:"2-digit",minute:"2-digit"});planttime.textContent+=" ( "+Math.round((eTime.getTime()-sTime.getTime())/6e4)+" mins ) ";infoDiv.appendChild(tag);infoDiv.appendChild(planttime);var noteDiv=document.createElement("DIV");noteDiv.className="note";noteDiv.id=tmptreelist[lIdx].browserTreeID;noteDiv.textContent+=tmptreelist[lIdx].plant.note;infoDiv.appendChild(noteDiv);var statusDiv=document.createElement("DIV");statusDiv.className="tree-status";var syncIcon=document.createElement("I");var syncTooltip=document.createElement("SPAN");syncTooltip.className="tooltiptext";switch(tmptreelist[lIdx].syncState){case"Success":syncIcon.className="tooltip fa fa-check";syncTooltip.textContent=chrome.i18n.getMessage("settings_status_200");break;case"Fail":syncIcon.className="tooltip fa fa-exclamation-triangle";if(tmptreelist[lIdx].failedStatus=="0"){syncTooltip.textContent=chrome.i18n.getMessage("settings_status_0")}else if(tmptreelist[lIdx].failedStatus=="403"){syncTooltip.textContent=chrome.i18n.getMessage("settings_status_403")}else{syncTooltip.textContent=chrome.i18n.getMessage("settings_status_fail")}break;case"EditFail":syncIcon.className="tooltip fa fa-exclamation-triangle";if(tmptreelist[lIdx].failedStatus=="0"){syncTooltip.textContent=chrome.i18n.getMessage("settings_status_0")}else if(tmptreelist[lIdx].failedStatus=="403"){syncTooltip.textContent=chrome.i18n.getMessage("settings_status_403")}else{syncTooltip.textContent=chrome.i18n.getMessage("settings_status_fail")}break;case"WaitForSync":syncIcon.className="tooltip fa fa-refresh";syncTooltip.textContent=chrome.i18n.getMessage("settings_status_waitforsync");break}syncIcon.appendChild(syncTooltip);syncIcon.setAttribute("style","font-size:20px;");statusDiv.appendChild(syncIcon);tree.appendChild(infoDiv);tree.appendChild(statusDiv);treeList.appendChild(tree)}newdiv.appendChild(treeList);document.getElementById("tree-container").appendChild(newdiv)}}};var addToList=function(listType,url){var list,newBox;switch(listType){case"blacklist":list=document.getElementById("blacklist");newBox=document.getElementById("new-black");break;case"whitelist":list=document.getElementById("whitelist");newBox=document.getElementById("new-white");break;default:}var newLi=document.createElement("LI");var x=document.createElement("IMG");x.src="images/settings/delete.png";x.className="x buttons";x.alt="X";newLi.appendChild(x);newLi.appendChild(document.createTextNode(" "));newLi.appendChild(document.createTextNode(" "));var fav=document.createElement("IMG");fav.src="http://"+url+"/favicon.ico";fav.className="favicon";fav.addEventListener("error",function(event){this.src="images/settings/defaultFavicon.png"},false);newLi.appendChild(fav);newLi.appendChild(document.createTextNode(" "));newLi.appendChild(document.createTextNode(" "));var domain=document.createElement("SPAN");domain.textContent=url;newLi.appendChild(domain);list.insertBefore(newLi,newBox.nextElementSibling)};var addBlacklist=function(event){var t=document.getElementById("new-black-box");var v=t.value.trim();if(v.length>=0){addToList("blacklist",v);saveList("blacklist")}t.value=""};var addWhitelist=function(event){var t=document.getElementById("new-white-box");var v=t.value.trim();if(v.length>=0){addToList("whitelist",v);saveList("whitelist")}t.value=""};var chooseMode=function(event){var t=event.target;var blist=document.getElementById("blacklist");var wlist=document.getElementById("whitelist");if(t.id=="blacklist-toggle"){addClass(wlist,"disappear");removeClass(blist,"disappear");addClass(document.getElementById("settings-whitelist-description"),"disappear");removeClass(document.getElementById("settings-blacklist-description"),"disappear")}else if(t.id=="whitelist-toggle"){addClass(blist,"disappear");removeClass(wlist,"disappear");removeClass(document.getElementById("settings-whitelist-description"),"disappear");addClass(document.getElementById("settings-blacklist-description"),"disappear")}var inputs=document.getElementsByTagName("INPUT");var isWhitelistMode=t.id==="whitelist-toggle"?true:false;bgpage.setWhitelistMode(isWhitelistMode);chrome.storage.local.set({isWhitelistMode:isWhitelistMode},function(){})};function initList(){chrome.storage.local.get({blackList:bgpage.getDefaultBlacklist(),whiteList:bgpage.getDefaultWhitelist(),isWhitelistMode:false},function(items){var blacklist=items.blackList;var blacklistElement=document.getElementById("blacklist");var bChilds;bChilds=blacklistElement.children;while(blacklistElement.lastChild.id!=="new-black"){blacklistElement.removeChild(blacklistElement.lastChild)}for(var bIdx in blacklist){addToList("blacklist",blacklist[blacklist.length-bIdx-1])}var whitelist=items.whiteList;var whitelistElement=document.getElementById("whitelist");bChilds=whitelistElement.children;while(whitelistElement.lastChild.id!=="new-white"){whitelistElement.removeChild(whitelistElement.lastChild)}for(var wIdx in whitelist){addToList("whitelist",whitelist[whitelist.length-wIdx-1])}})}function initSyncList(){chrome.storage.local.get({user:null,grownTree:null},function(items){var treelist=items.grownTree;var synclistEllement=document.getElementById("tree-container");var tChilds;tChilds=synclistEllement.children;while(synclistEllement.lastChild.id!=="list-head"){synclistEllement.removeChild(synclistEllement.lastChild)}var listDate=(new Date).getDate();var newtreelist=new Array;newtreelist[0]=new Array;var dayIdx=0;if(items.grownTree!=null&&items.grownTree.length!=0){addClass(document.getElementById("synclist-no-tree"),"disappear");removeClass(document.getElementById("synclist-limit"),"disappear");addClass(document.getElementById("no-sync-btn"),"disappear");addClass(document.getElementById("sync-btn"),"disappear");if(items.user!=null){removeClass(document.getElementById("sync-btn"),"disappear")}else{removeClass(document.getElementById("no-sync-btn"),"disappear")}for(var tIdx in treelist){var tmpDate=new Date(treelist[tIdx].plant.end_time);if(tmpDate.getDate()!=listDate){dayIdx++;listDate=tmpDate.getDate();newtreelist[dayIdx]=new Array}newtreelist[dayIdx].push(treelist[tIdx])}addTreeDaylist(newtreelist)}else{addClass(document.getElementById("no-sync-btn"),"disappear");addClass(document.getElementById("sync-btn"),"disappear");removeClass(document.getElementById("synclist-no-tree"),"disappear");addClass(document.getElementById("synclist-limit"),"disappear")}getprofile()})}function getprofile(){chrome.storage.local.get({user:null},function(items){if(items.user!=null){var xhr=new XMLHttpRequest;var url="https://c88fef96.forestapp.cc/api/v1/users/"+items.user.user_id+"/profile";xhr.open("GET",url,true);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){var resp=JSON.parse(xhr.responseText);chrome.storage.local.set({profile:resp},function(){var avatar=document.getElementById("profile-avatar");if(resp.avatar_url==null){avatar.src="images/settings/empty_avatar.png"}else{avatar.src=resp.avatar_url}var name=document.getElementById("profile-name");name.textContent=resp.name;var healthy=document.getElementById("profile-healthy");healthy.textContent=resp.health_count;var sucessrate=document.getElementById("profile-rate");var rate=resp.health_count+resp.death_count>0?Math.round(resp.health_count/(resp.health_count+resp.death_count)*100):0;sucessrate.textContent=rate+"%";var tabAvatar=document.getElementById("tab-info-avatar");tabAvatar.src=resp.avatar_url;var tabName=document.getElementById("tab-info-name");tabName.textContent=resp.name;getcoin()})}else{}}};xhr.send()}else{}})}function getcoin(){chrome.storage.local.get({user:null},function(items){if(items.user!=null){var xhr=new XMLHttpRequest;var url="https://c88fef96.forestapp.cc/api/v1/users/"+items.user.id+"/coin?authenticate_token="+items.user.remember_token;xhr.open("GET",url,true);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){var resp=JSON.parse(xhr.responseText);chrome.storage.local.set({coin:resp.coin},function(){var coin=document.getElementById("profile-coin");coin.textContent=resp.coin})}else{}}};xhr.send()}else{}})}function gettags(callback){clearEditTag(function(){chrome.storage.local.get({user:null},function(items){var editTag=document.getElementById("edit-tag");var tag;if(items.user!=null){var xhr=new XMLHttpRequest;var url="https://c88fef96.forestapp.cc/api/v1/tags?authenticate_token="+items.user.remember_token;xhr.open("GET",url,true);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){var resp=JSON.parse(xhr.responseText);var newTAGs=resp.tags;TAG=new Array;TAG.push({tag_id:0,title:chrome.i18n.getMessage("plant_tag_0")});for(var Idx in newTAGs){if(newTAGs[Idx].deleted!=true){var tempTag=new Object;if(newTAGs[Idx].tag_id!=0&&newTAGs[Idx].tag_id!="0"){tempTag.tag_id=newTAGs[Idx].tag_id;tempTag.title=newTAGs[Idx].title;TAG.push(tempTag)}}}if(TAG==null||TAG.length==1){TAG=DefaultTAG}for(var Idx in TAG){tag=document.createElement("OPTION");tag.value=TAG[Idx].title;tag.textContent=TAG[Idx].title;editTag.appendChild(tag)}chrome.storage.local.set({tag:TAG},function(){})}else{}callback()}};xhr.send()}})})}function login(){removeClass(document.getElementById("login-loading"),"disappear");addClass(document.getElementById("login-message"),"disappear");var xhr=new XMLHttpRequest;xhr.open("POST","https://c88fef96.forestapp.cc/api/v1/sessions",true);var email=document.getElementById("login-email-input").value;email=email.replace("\\b","");email=email.trim();var string=JSON.stringify({email:email,password:document.getElementById("login-password-input").value});xhr.setRequestHeader("Access-Control-Allow-Origin","*");xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){var resp=JSON.parse(xhr.responseText);window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear");addClass(document.getElementById("login-loading"),"disappear")},300);addClass(document.getElementById("info-no-login"),"disappear");removeClass(document.getElementById("info-has-login"),"disappear");removeClass(document.getElementById("tab-logout"),"disappear");chrome.storage.local.set({user:resp},function(){bgpage.updatePurchasedProducts(function(){});getprofile();gettags(function(){bgpage.updateFromServer("login",function(){initSyncList()})})})}else{removeClass(document.getElementById("login-message"),"disappear");addClass(document.getElementById("login-loading"),"disappear");if(xhr.status==403){setText("login-message",chrome.i18n.getMessage("settings_login_failed"))}else{setText("login-message",chrome.i18n.getMessage("settings_login_failed_error_code")+" "+xhr.status)}}}};xhr.send(string)}window.onload=function(){clearEditTag(function(){chrome.storage.local.get({tag:null,DefaultTAG:DefaultTAG},function(items){var editTag=document.getElementById("edit-tag");var tag;TAG=items.tag;if(TAG==null){TAG=items.DefaultTAG}for(var Idx in TAG){tag=document.createElement("OPTION");tag.value=TAG[Idx].title;tag.textContent=TAG[Idx].title;editTag.appendChild(tag)}})});window.addEventListener("scroll",function(event){var scrollY=window.scrollY;var isScrollDown;if(scrollY<lastScrollY){isScrollDown=false}else{isScrollDown=true}if(scrollY>130&&isScrollDown&&!isHeaderHide){addClass(document.getElementById("tab"),"tab-fixed");removeClass(document.getElementById("tab-space"),"disappear");chrome.storage.local.get({user:null},function(items){if(items.user!=null){removeClass(document.getElementById("tab-info"),"disappear")}});isHeaderHide=true}else if(scrollY<130&&!isScrollDown&&isHeaderHide){removeClass(document.getElementById("tab"),"tab-fixed");addClass(document.getElementById("tab-space"),"disappear");chrome.storage.local.get({user:null},function(items){if(items.user!=null){addClass(document.getElementById("tab-info"),"disappear")}});isHeaderHide=false}lastScrollY=scrollY});window.addEventListener("click",function(event){var t=event.target;if(hasClass(t,"x")){var listType=t.parentNode.parentNode.id;t.parentNode.parentNode.removeChild(t.parentNode);saveList(listType)}if(hasClass(t,"choose-mode")){chooseMode(event)}if(hasClass(t,"os")){var id=t.id;var url="";if(id==="iphone"){url="https://itunes.apple.com/app/forest-stay-focused-stop-phubbing/id866450515?mt=8"}else if(id==="android"){url="https://play.google.com/store/apps/details?id=cc.forestapp"}else if(id==="windows"){url="https://www.microsoft.com/store/apps/9WZDNCRDNLJK"}else{}chrome.tabs.create({url:url},function(tab){});chrome.storage.local.get({user:null},function(items){})}if(t.id=="login-link"||t.id=="no-sync-btn"){removeClass(document.getElementById("login-popup"),"disappear");window.setTimeout(function(){removeClass(document.getElementById("login-popup"),"login-popup-shrink")},10);removeClass(document.getElementById("login-mask"),"disappear");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"login-masked")},10)}if(t.id=="login-cancel"||t.id=="login-mask"){window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear")},300);removeClass(document.getElementById("login-mask"),"login-masked");addClass(document.getElementById("login-message"),"disappear");addClass(document.getElementById("login-loading"),"disappear")}if(t.id=="login-btn"){login()}if(t.id=="settings_sync_tree_species_manually"){addClass(document.getElementById("settings_sync_tree_species_manually_pre"),"disappear");addClass(document.getElementById("settings_sync_tree_species_manually"),"disappear");removeClass(document.getElementById("settings_syncing_tree_species_manually"),"disappear");bgpage.updatePurchasedProducts(function(){bgpage.uploadTree("sync",function(){});window.setTimeout(function(){removeClass(document.getElementById("settings_sync_tree_species_manually_pre"),"disappear");removeClass(document.getElementById("settings_sync_tree_species_manually"),"disappear");addClass(document.getElementById("settings_syncing_tree_species_manually"),"disappear")},1e3)})}if(t.id=="tab-logout"){var xhr=new XMLHttpRequest;xhr.open("DELETE","https://c88fef96.forestapp.cc/api/v1/sessions/signout",true);chrome.storage.local.get({user:null},function(items){var user=items.user;var string=JSON.stringify(user);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){chrome.storage.local.remove(["user","profile","coin"],function(){});addClass(document.getElementById("tab-logout"),"disappear");addClass(document.getElementById("info-has-login"),"disappear");removeClass(document.getElementById("info-no-login"),"disappear");initSyncList();bgpage.updatePurchasedProducts(function(){});addClass(document.getElementById("tab-info"),"disappear");addClass(document.getElementById("tab-space"),"disappear");var avatar=document.getElementById("profile-avatar");avatar.src="images/settings/empty_avatar.png";var name=document.getElementById("profile-name");name.textContent="";var healthy=document.getElementById("profile-healthy");healthy.textContent="";var sucessrate=document.getElementById("profile-rate");sucessrate.textContent="";var tabAvatar=document.getElementById("tab-info-avatar");tabAvatar.src="";var tabName=document.getElementById("tab-info-name");tabName.textContent="";var coin=document.getElementById("profile-coin");coin.textContent=""}else{}}};xhr.send(string)})}if(t.id=="settings_no_account_iosapp"){}if(t.id=="settings_no_account_androidapp"){}if(t.id=="tab-settings"){addClass(t,"active");var contentSettings=document.getElementById("settings");var contentSynclist=document.getElementById("synclist");var tabSynclist=document.getElementById("tab-synclist");removeClass(tabSynclist,"active");removeClass(contentSettings,"disappear");addClass(contentSynclist,"disappear")}if(t.id=="tab-synclist"){initSyncList();addClass(t,"active");var contentSettings=document.getElementById("settings");var contentSynclist=document.getElementById("synclist");var tabSettings=document.getElementById("tab-settings");removeClass(tabSettings,"active");removeClass(contentSynclist,"disappear");addClass(contentSettings,"disappear")}if(t.id=="sync-btn"||t.id=="sync-btn-title"||t.id=="sync-btn-icon"){if(!isUploading){isUploading=true;addClass(document.getElementById("sync-btn-icon"),"icon-spin");removeClass(document.getElementById("sync-btn"),"buttons");gettags(function(){bgpage.uploadTree("sync",function(){addClass(document.getElementById("sync-btn"),"buttons");initSyncList();removeClass(document.getElementById("sync-btn-icon"),"icon-spin");addClass(document.getElementById("no-sync-btn"),"disappear");isUploading=false})})}}if(hasClass(t,"note")){var note_node=t;var tag_node=null;var tag_node=t.parentNode.querySelector(".tree-tag");if(tag_node==null){return}chrome.storage.local.set({tempTag:tag_node.textContent,tempNote:note_node.textContent},function(){updateEditUI(t.id);removeClass(document.getElementById("edit-popup"),"disappear");window.setTimeout(function(){removeClass(document.getElementById("edit-popup"),"edit-popup-shrink")},10);removeClass(document.getElementById("edit-mask"),"disappear");window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"edit-masked")},10)})}if(t.id=="edit-cancel"||t.id=="edit-mask"){window.setTimeout(function(){addClass(document.getElementById("edit-popup"),"disappear")},300);addClass(document.getElementById("edit-popup"),"edit-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"disappear")},300);removeClass(document.getElementById("edit-mask"),"edit-masked")}if(t.id=="edit-btn"){EditTreeInfo()}},false);window.addEventListener("contextmenu",function(event){event.preventDefault();return false},true);document.getElementById("new-black-box").addEventListener("keypress",function(e){if(!e){e=window.event}var keyCode=e.keyCode||e.which;if(keyCode===13){addBlacklist();document.getElementById("new-black-box").blur()}},false);document.getElementById("new-white-box").addEventListener("keypress",function(e){if(!e){e=window.event}var keyCode=e.keyCode||e.which;if(keyCode===13){addWhitelist();document.getElementById("new-white-box").blur()}},false);window.addEventListener("keypress",function(event){if(event.keyCode==13&&(event.target.id=="login-email-input"||event.target.id=="login-password-input")){login();return false}},false);initList();chrome.storage.local.get({user:null,isWhitelistMode:false},function(items){var user=items.user;if(user!==null){window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear")},300);removeClass(document.getElementById("login-mask"),"login-masked");addClass(document.getElementById("info-no-login"),"disappear");removeClass(document.getElementById("info-has-login"),"disappear");addClass(document.getElementById("no-sync-btn"),"disappear");removeClass(document.getElementById("sync-btn"),"disappear");removeClass(document.getElementById("tab-logout"),"disappear");bgpage.updatePurchasedProducts(function(){});getprofile()}if(items.isWhitelistMode){document.getElementById("whitelist-toggle").click()}else{document.getElementById("blacklist-toggle").click()}});setText("settings_blacklist_title",chrome.i18n.getMessage("settings_blacklist_title"));setText("settings_whitelist_title",chrome.i18n.getMessage("settings_whitelist_title"));document.getElementById("new-black-box").placeholder=chrome.i18n.getMessage("settings_newblackbox_placeholder");document.getElementById("new-white-box").placeholder=chrome.i18n.getMessage("settings_newblackbox_placeholder");setText("login-link",chrome.i18n.getMessage("settings_login_portal"));setText("settings_login_description",chrome.i18n.getMessage("settings_login_description"));setText("settings_no_account1",chrome.i18n.getMessage("settings_no_account1"));setText("settings_no_account_iosapp",chrome.i18n.getMessage("settings_no_account_iosapp"));setText("settings_no_account_or",chrome.i18n.getMessage("settings_no_account_or"));setText("settings_no_account_androidapp",chrome.i18n.getMessage("settings_no_account_androidapp"));setText("settings_no_account2",chrome.i18n.getMessage("settings_no_account2"));setText("settings_other_apps_title",chrome.i18n.getMessage("settings_other_apps_title"));setText("login-title",chrome.i18n.getMessage("settings_login_title"));setText("login-btn",chrome.i18n.getMessage("settings_login_btn"));setText("login-cancel",chrome.i18n.getMessage("settings_login_cancel"));setText("login-email-title",chrome.i18n.getMessage("settings_login_email"));setText("login-password-title",chrome.i18n.getMessage("settings_login_password"));setText("settings_other_apps_description",chrome.i18n.getMessage("settings_other_apps_description"));setText("settings_os_iphone",chrome.i18n.getMessage("settings_os_iphone"));setText("settings_os_android",chrome.i18n.getMessage("settings_os_android"));setText("synclist-no-tree-description",chrome.i18n.getMessage("settings_synclist_no_tree"));setText("synclist-no-tree-only-browser",chrome.i18n.getMessage("settings_only_browser"));setText("synclist-limit-description",chrome.i18n.getMessage("settings_synclist_limit"));setText("synclist-limit-only-browser",chrome.i18n.getMessage("settings_only_browser"));setText("tab-settings",chrome.i18n.getMessage("settings_tab_settings"));setText("tab-synclist",chrome.i18n.getMessage("settings_tab_synclist"));setText("no-sync-btn",chrome.i18n.getMessage("settings_no_sync_btn"));setText("sync-btn-title",chrome.i18n.getMessage("settings_sync_btn"));setText("sync-btn-done",chrome.i18n.getMessage("settings_sync_completed"));setText("tab-logout",chrome.i18n.getMessage("settings_tab_logout"));setText("settings-whitelist-description",chrome.i18n.getMessage("settings_whitelist_description"));setText("settings-blacklist-description",chrome.i18n.getMessage("settings_blacklist_description"));setText("edit-btn",chrome.i18n.getMessage("settings_edit_btn"));setText("edit-cancel",chrome.i18n.getMessage("settings_edit_cancel"))}})();