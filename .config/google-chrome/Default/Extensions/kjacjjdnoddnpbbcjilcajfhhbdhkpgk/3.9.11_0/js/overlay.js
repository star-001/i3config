var isPlanting=false;var timer;(function(){"use strict";function disableKeyboard(e){if(!isPlanting){return true}e.preventDefault();e.stopImmediatePropagation();return false}function disableOverlay(){isPlanting=false;var overlayContainer=document.getElementById("forest-overlay-container");if(typeof overlayContainer!="undefined"&&overlayContainer!==null){overlayContainer.className=overlayContainer.className+" forest-overlay-fadeout";window.setTimeout(function(){overlayContainer.parentNode.removeChild(overlayContainer);document.body.className=document.body.className.replace(/forest-body/g," ")},300)}}function giveUp(){chrome.runtime.sendMessage({giveUp:true},function(response){});dismissPopup()}function showPopup(){var popup=document.getElementById("forest-popup");if(typeof popup!="undefined"&&popup!==null){popup.className=popup.className.replace(/forest-disappear/,"");window.setTimeout(function(){popup.className=popup.className.replace(/forest-popup-shrink/,"")},10)}var popupMask=document.getElementById("forest-popup-mask");if(typeof popup!="undefined"&&popup!==null){popupMask.className=popupMask.className.replace(/forest-disappear/,"");window.setTimeout(function(){popupMask.className=popupMask.className+"forest-popup-masked"},10)}}function dismissPopup(){var popup=document.getElementById("forest-popup");if(typeof popup!="undefined"&&popup!==null){popup.className=popup.className+" forest-popup-shrink";window.setTimeout(function(){popup.className=popup.className+" forest-disappear"},300)}var popupMask=document.getElementById("forest-popup-mask");if(typeof popup!="undefined"&&popup!==null){popupMask.className=popupMask.className.replace(/forest-popup-masked/," ");window.setTimeout(function(){popupMask.className=popupMask.className+"forest-disappear"},10)}}function overlay(type,remainingTime,treeUrl){if(typeof document.body=="undefined"||document.body===null){return}if(document.body.className.indexOf("forest-body")<0){document.body.className=document.body.className+" forest-body "}var overlayContainer=document.getElementById("forest-overlay-container");if(typeof overlayContainer=="undefined"||overlayContainer===null){overlayContainer=document.createElement("div");overlayContainer.id="forest-overlay-container";document.body.appendChild(overlayContainer)}overlayContainer.className="forest-cursor forest-select forest-overlay-container";var overlay=document.getElementById("forest-overlay");if(typeof overlay=="undefined"||overlay===null){overlay=document.createElement("div");overlay.id="forest-overlay";overlayContainer.appendChild(overlay)}overlay.className="forest-cursor forest-select forest-overlay";var infoContainer=document.getElementById("forest-info-container");if(typeof infoContainer=="undefined"||infoContainer===null){infoContainer=document.createElement("div");infoContainer.id="forest-info-container";overlay.appendChild(infoContainer)}infoContainer.className="forest-cursor forest-select forest-info-container";var overlayTopText=document.getElementById("forest-overlay-top-text");if(typeof overlayTopText=="undefined"||overlayTopText===null){overlayTopText=document.createElement("span");overlayTopText.id="forest-overlay-top-text";infoContainer.appendChild(overlayTopText)}overlayTopText.textContent=type==="overlay"?chrome.i18n.getMessage("overlay_tree_still_growing"):chrome.i18n.getMessage("overlay_tree_is_dead");overlayTopText.className="forest-cursor forest-select forest-overlay-top-text";var treeBall=document.getElementById("forest-tree-ball");if(typeof treeBall=="undefined"||treeBall===null){treeBall=document.createElement("div");treeBall.id="forest-tree-ball";infoContainer.appendChild(treeBall)}treeBall.className="forest-cursor forest-select forest-tree-ball";var tree=document.getElementById("forest-tree");if(typeof tree=="undefined"||tree===null){tree=document.createElement("div");tree.id="forest-tree";treeBall.appendChild(tree)}var treeImg='url("'+chrome.extension.getURL(treeUrl)+'")';if(tree.style.backgroundImage!==treeImg){tree.style.backgroundImage=treeImg}tree.className="forest-cursor forest-select forest-tree";var overlayBottomText=document.getElementById("forest-overlay-bottom-text");if(typeof overlayBottomText=="undefined"||overlayBottomText===null){overlayBottomText=document.createElement("span");overlayBottomText.id="forest-overlay-bottom-text";infoContainer.appendChild(overlayBottomText)}if(type==="overlay"){overlayBottomText.textContent=remainingTime}overlayBottomText.className="forest-cursor forest-select forest-overlay-bottom-text";var giveupButton=document.getElementById("forest-giveup-button");if(typeof giveupButton=="undefined"||giveupButton===null){giveupButton=document.createElement("div");giveupButton.id="forest-giveup-button";giveupButton.textContent=chrome.i18n.getMessage("overlay_giveup");infoContainer.appendChild(giveupButton);giveupButton.addEventListener("click",showPopup,false)}giveupButton.className="forest-cursor forest-select forest-giveup-button forest-buttons";var popupMask=document.getElementById("forest-popup-mask");if(typeof popupMask=="undefined"||popupMask===null){popupMask=document.createElement("div");popupMask.id="forest-popup-mask";popupMask.className="forest-cursor forest-select forest-popup-mask forest-disappear";popupMask.addEventListener("click",dismissPopup,false);infoContainer.appendChild(popupMask)}var popup=document.getElementById("forest-popup");if(typeof popup=="undefined"||popup===null){popup=document.createElement("div");popup.id="forest-popup";popup.className="forest-cursor forest-select forest-popup forest-disappear forest-popup-shrink";infoContainer.appendChild(popup)}var popupTitle=document.getElementById("forest-popup-title");if(typeof popupTitle=="undefined"||popupTitle===null){popupTitle=document.createElement("div");popupTitle.id="forest-popup-title";popupTitle.textContent=chrome.i18n.getMessage("overlay_popup_title");popupTitle.className="forest-cursor forest-select forest-popup-title";popup.appendChild(popupTitle);popup.appendChild(document.createElement("br"))}var popupMessage=document.getElementById("forest-popup-message");if(typeof popupMessage=="undefined"||popupMessage===null){popupMessage=document.createElement("div");popupMessage.id="forest-popup-message";popupMessage.textContent=chrome.i18n.getMessage("overlay_popup_message");popupMessage.className="forest-cursor forest-select forest-popup-message";popup.appendChild(popupMessage)}var popupConfirmButton=document.getElementById("forest-popup-confirm-button");if(typeof popupConfirmButton=="undefined"||popupConfirmButton===null){popupConfirmButton=document.createElement("div");popupConfirmButton.id="forest-popup-confirm-button";popupConfirmButton.textContent=chrome.i18n.getMessage("overlay_popup_confirm");popupConfirmButton.className="forest-cursor forest-select forest-popup-confirm-button forest-buttons";popupConfirmButton.addEventListener("click",giveUp,false);popup.appendChild(popupConfirmButton)}var popupCancelButton=document.getElementById("forest-popup-cancel-button");if(typeof popupCancelButton=="undefined"||popupCancelButton===null){popupCancelButton=document.createElement("div");popupCancelButton.id="forest-popup-cancel-button";popupCancelButton.textContent=chrome.i18n.getMessage("overlay_popup_cancel");popupCancelButton.className="forest-cursor forest-select forest-popup-cancel-button forest-buttons";popupCancelButton.addEventListener("click",dismissPopup,false);popup.appendChild(popupCancelButton)}}function dummy(){}window.addEventListener("keydown",disableKeyboard,true);window.addEventListener("keypress",disableKeyboard,true);window.addEventListener("keyup",disableKeyboard,true);chrome.runtime.onMessage.addListener(function(m,sender,dummy){clearTimeout(timer);if(m.type==="overlay"){overlay(m.type,m.timerText,m.treeUrl);isPlanting=true;timer=setTimeout(disableOverlay,2e3)}else if(m.type==="failed"){overlay(m.type,m.timerText,m.treeUrl);isPlanting=true;dismissPopup();var giveupButton=document.getElementById("forest-giveup-button");if(typeof giveupButton!="undefined"||giveupButton!==null){giveupButton.parentNode.removeChild(giveupButton)}timer=setTimeout(disableOverlay,2e3)}else{disableOverlay()}dummy()})})();