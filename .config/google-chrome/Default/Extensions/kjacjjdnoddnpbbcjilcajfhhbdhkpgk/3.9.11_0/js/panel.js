var wheelFlag=false;(function(){"use strict";var bgpage=chrome.extension.getBackgroundPage();var TAG;var clearEditTag=function(callback){var editTag=document.getElementById("edit-tag");while(editTag.options.length>0){editTag.remove(0)}callback()};var updateEditUI=function(){chrome.storage.local.get({planting:null,grownTree:null},function(items){var plant;var plantTag;var plantNote;var editTag=document.getElementById("edit-tag");if(bgpage.currentState==bgpage.TREE_STATUS.GROWING&&items.planting!=null){plant=items.planting;plantTag=plant.plant.tag;plantNote=plant.plant.note;var TagIdx=TAG.findIndex(function(t){return t.tag_id==parseInt(plantTag)});if(TagIdx==-1){TagIdx=0}editTag.selectedIndex=TagIdx;var editNote=document.getElementById("edit-note");editNote.value=plantNote}else if(bgpage.currentState==bgpage.TREE_STATUS.GROWN&&items.grownTree!=null&&items.grownTree.length!=0){plant=items.grownTree[0];plantTag=plant.plant.tag;plantNote=plant.plant.note;var TagIdx=TAG.findIndex(function(t){return t.tag_id==parseInt(plantTag)});if(TagIdx==-1){TagIdx=0}editTag.selectedIndex=TagIdx;var editNote=document.getElementById("edit-note");editNote.value=plantNote}else if(bgpage.currentState==bgpage.TREE_STATUS.FAILED&&items.grownTree!=null&&items.grownTree.length!=0){plant=items.grownTree[0];plantTag=plant.plant.tag;plantNote=plant.plant.note;var TagIdx=TAG.findIndex(function(t){return t.tag_id==parseInt(plantTag)});if(TagIdx==-1){TagIdx=0}editTag.selectedIndex=TagIdx;var editNote=document.getElementById("edit-note");editNote.value=plantNote}})};function init(){setText("main_settings_tooltip",chrome.i18n.getMessage("main_settings_tooltip"));setText("main_add_blacklist_tooltip",bgpage.getIsWhitelistMode()?chrome.i18n.getMessage("main_add_whitelist_tooltip"):chrome.i18n.getMessage("main_add_blacklist_tooltip"));setText("finish-message-for-user",chrome.i18n.getMessage("main_grown_popup_user_reward_pre"));setText("finish-message-for-guest-text-pre",chrome.i18n.getMessage("main_grown_popup_guest_info_pre"));setText("finish-message-for-guest-link",chrome.i18n.getMessage("main_grown_popup_guest_info_link"));setText("finish-message-for-guest-text-post",chrome.i18n.getMessage("main_grown_popup_guest_info_post"));setText("do-not-show-finish-message-text",chrome.i18n.getMessage("main_grown_popup_guest_do_not_show_again"));setText("main_edit_tooltip",chrome.i18n.getMessage("main_edit_tooltip"));setText("edit-btn",chrome.i18n.getMessage("main_edit_popup_btn"));setText("edit-cancel",chrome.i18n.getMessage("main_edit_popup_cancel"));bgpage.updateUI();chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){var tab=tabs[0];if(!bgpage.getIsWhitelistMode()&&bgpage.isBlacklisted(tab)||bgpage.getIsWhitelistMode()&&bgpage.isWhitelisted(tab)){addClass(document.getElementById("add-to-blacklist-icon"),"hidden")}});clearEditTag(function(){chrome.storage.local.get({tag:null,DefaultTAG:null},function(items){var editTag=document.getElementById("edit-tag");var tag;TAG=items.tag;if(TAG==null){TAG=items.DefaultTAG}for(var Idx in TAG){tag=document.createElement("OPTION");tag.value=TAG[Idx].title;tag.textContent=TAG[Idx].title;editTag.appendChild(tag)}})});document.getElementById("finish-message-for-guest-link").addEventListener("click",function(event){},false)}window.addEventListener("click",function(event){var t=event.target;if(t.id=="treeball"||t.id=="plant-board"||t.id=="plant-board-text"||t.id=="seed"||t.id=="tree"){bgpage.startTimer(false)}if(t.id=="twitterBtn"||t.id=="fbBtn"){bgpage.clickShareButton(t.id)}if(t.id=="back-icon"){bgpage.clickShareButton("backBtn")}if(t.id=="add-to-blacklist-icon"&&hasClass(t,"buttons")){chrome.tabs.query({active:true,lastFocusedWindow:true},function(tabs){var tab=tabs[0];var parserA=document.createElement("a");parserA.href=tab.url;var host=parserA.hostname;if(host!=null){if(bgpage.getIsWhitelistMode()){chrome.storage.local.get({whiteList:bgpage.getDefaultWhitelist()},function(items){var whitelist=items.whiteList;for(var idx in whitelist){if(whitelist[idx].indexOf(host)>=0){return}}whitelist.splice(0,0,host);bgpage.setWhitelist(whitelist);chrome.storage.local.set({whiteList:whitelist},function(){})})}else{chrome.storage.local.get({blackList:bgpage.getDefaultBlacklist()},function(items){var blacklist=items.blackList;for(var idx in blacklist){if(blacklist[idx].indexOf(host)>=0){return}}blacklist.splice(0,0,host);bgpage.setBlacklist(blacklist);chrome.storage.local.set({blackList:blacklist},function(){})})}}});var atbIcon=document.getElementById("add-to-blacklist-icon");removeClass(atbIcon,"buttons");setTimeout(function(){addClass(atbIcon,"convergeToPoint");setTimeout(function(){addClass(atbIcon,"checked");removeClass(atbIcon,"convergeToPoint");setTimeout(function(){addClass(atbIcon,"convergeToPoint");setTimeout(function(){addClass(atbIcon,"hidden");removeClass(atbIcon,"checked");removeClass(atbIcon,"convergeToPoint");addClass(atbIcon,"buttons")},200)},500)},200)},100);chrome.storage.local.get({user:null},function(items){})}if(t.id=="setting-icon"){removeClass(document.getElementById("setting-mask"),"disappear");setTimeout(function(){chrome.runtime.openOptionsPage(null)},100)}if(t.id=="edit-icon"||t.id=="editBtn"){updateEditUI();removeClass(document.getElementById("edit-mask"),"hidden");removeClass(document.getElementById("edit-popup"),"hidden");addClass(document.getElementById("edit-mask"),"edit-masked");window.setTimeout(function(){removeClass(document.getElementById("edit-popup"),"edit-popup-shrink")},200);window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"edit-masked")},200)}if(t.id=="edit-btn"){chrome.storage.local.get({planting:null,grownTree:null},function(items){var planting=items.planting;var grownTree=items.grownTree;console.log(planting);var PTag=document.getElementById("edit-tag").value;var PNote=document.getElementById("edit-note").value;var TagIdx=TAG.findIndex(function(t){return t.title==PTag});if(bgpage.currentState==bgpage.TREE_STATUS.GROWING){if(planting!=null){planting.plant.tag=parseInt(TAG[TagIdx].tag_id);bgpage.saveLastTreeTagId(parseInt(TAG[TagIdx].tag_id));planting.plant.note=PNote}}else if(bgpage.currentState==bgpage.TREE_STATUS.GROWN||bgpage.currentState==bgpage.TREE_STATUS.FAILED){if(grownTree!=null||grownTree.length!=0){grownTree[0].plant.tag=parseInt(TAG[TagIdx].tag_id);bgpage.saveLastTreeTagId(parseInt(TAG[TagIdx].tag_id));grownTree[0].plant.note=PNote;grownTree[0].syncState="WaitForSync"}}chrome.storage.local.set({planting:planting,grownTree:grownTree},function(){addClass(document.getElementById("edit-popup"),"edit-popup-shrink");removeClass(document.getElementById("edit-mask"),"edit-masked");window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"hidden");addClass(document.getElementById("edit-popup"),"hidden")},300)})})}if(t.id=="edit-cancel"){addClass(document.getElementById("edit-popup"),"edit-popup-shrink");removeClass(document.getElementById("edit-mask"),"edit-masked");window.setTimeout(function(){addClass(document.getElementById("edit-mask"),"hidden");addClass(document.getElementById("edit-popup"),"hidden")},300)}if(t.id=="timer-left-arrow"){bgpage.adjustPlantTime(1);chrome.storage.local.get({user:null},function(items){})}if(t.id=="timer-right-arrow"){bgpage.adjustPlantTime(-1);chrome.storage.local.get({user:null},function(items){})}if(t.id=="treeball-left-arrow"){bgpage.adjustTreeType(1);chrome.storage.local.get({user:null},function(items){})}if(t.id=="treeball-right-arrow"){bgpage.adjustTreeType(-1);chrome.storage.local.get({user:null},function(items){})}if(t.id=="confirm-btn"){var doNotShowFinishMessageForGuest=document.getElementById("do-not-show-finish-message").checked;bgpage.onClickFinishConfirmedButton(doNotShowFinishMessageForGuest)}},false);window.addEventListener("wheel",function(event){if(event.target.id=="treeball"||event.target.id=="plant-board"||event.target.id=="plant-board-text"){return}if(wheelFlag){return}wheelFlag=true;setTimeout(function(){wheelFlag=false},50);var delta=event.deltaY>0?1:event.deltaY<0?-1:0;bgpage.adjustPlantTime(delta)},false);window.addEventListener("contextmenu",function(event){event.preventDefault();return false},true);window.onload=init})();